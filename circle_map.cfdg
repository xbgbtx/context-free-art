CF::Impure = 1

startshape GRID []

grid_size=512

N = 1000

F(i,w,k) = i+w+k*sin(360*i)

//Linear interpolation
lerp(n0,n1,i)=n0+(n1-n0)*i

shape GRID
{
   loop i=grid_size [ x 1 ]
   loop j=grid_size [ y 1 ]
   {
      w = i/grid_size
      k = j/grid_size
      CELL ( N, 0, w, k ) []
   }
}

shape CELL(n,i,w,k)
{
   if ( n <= 0 )
   {
      t = i/N
      B = t
      H = lerp(0,280,1-t)
      SQUARE [ b B sat 1 h H ]
   }
   else
   {
      CELL ( n-1, F(i,w,k), w, k ) []
   }
}
